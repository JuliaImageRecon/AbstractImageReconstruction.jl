<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Direct Reconstruction · AbstractImageReconstruction.jl</title><meta name="title" content="Direct Reconstruction · AbstractImageReconstruction.jl"/><meta property="og:title" content="Direct Reconstruction · AbstractImageReconstruction.jl"/><meta property="twitter:title" content="Direct Reconstruction · AbstractImageReconstruction.jl"/><meta name="description" content="Documentation for AbstractImageReconstruction.jl."/><meta property="og:description" content="Documentation for AbstractImageReconstruction.jl."/><meta property="twitter:description" content="Documentation for AbstractImageReconstruction.jl."/><meta property="og:url" content="https://github.com/JuliaImageRecon/AbstractImageReconstruction.jl/generated/example/2_direct/"/><meta property="twitter:url" content="https://github.com/JuliaImageRecon/AbstractImageReconstruction.jl/generated/example/2_direct/"/><link rel="canonical" href="https://github.com/JuliaImageRecon/AbstractImageReconstruction.jl/generated/example/2_direct/"/><script data-outdated-warner src="../../../assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.050/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.8/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL="../../.."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../../../assets/documenter.js"></script><script src="../../../search_index.js"></script><script src="../../../siteinfo.js"></script><script src="../../../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../../assets/themes/catppuccin-mocha.css" data-theme-name="catppuccin-mocha"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../../assets/themes/catppuccin-macchiato.css" data-theme-name="catppuccin-macchiato"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../../assets/themes/catppuccin-frappe.css" data-theme-name="catppuccin-frappe"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../../assets/themes/catppuccin-latte.css" data-theme-name="catppuccin-latte"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../../../assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><div class="docs-package-name"><span class="docs-autofit"><a href="../../../">AbstractImageReconstruction.jl</a></span></div><button class="docs-search-query input is-rounded is-small is-clickable my-2 mx-auto py-1 px-2" id="documenter-search-query">Search docs (Ctrl + /)</button><ul class="docs-menu"><li><a class="tocitem" href="../../../">Home</a></li><li><input class="collapse-toggle" id="menuitem-2" type="checkbox" checked/><label class="tocitem" for="menuitem-2"><span class="docs-label">Example: Radon Reconstruction Package</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../../example_intro/">Introduction</a></li><li><a class="tocitem" href="../0_radon_data/">Radon Data</a></li><li><a class="tocitem" href="../1_interface/">Interface</a></li><li class="is-active"><a class="tocitem" href>Direct Reconstruction</a><ul class="internal"><li><a class="tocitem" href="#Parameters-and-Processing"><span>Parameters and Processing</span></a></li><li><a class="tocitem" href="#Algorithm"><span>Algorithm</span></a></li></ul></li><li><a class="tocitem" href="../3_direct_result/">Direct Reconstruction Result</a></li><li><a class="tocitem" href="../4_iterative/">Iterative Reconstruction</a></li><li><a class="tocitem" href="../5_iterative_result/">Iterative Reconstruction Result</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-3" type="checkbox"/><label class="tocitem" for="menuitem-3"><span class="docs-label">How to</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../howto/serialization/">Serialization</a></li><li><a class="tocitem" href="../../howto/caching/">Caching</a></li><li><a class="tocitem" href="../../howto/observables/">Observables</a></li><li><a class="tocitem" href="../../howto/multi_threading/">Multi-Threading</a></li></ul></li><li><a class="tocitem" href="../../../API/api/">API Reference</a></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><a class="docs-sidebar-button docs-navbar-link fa-solid fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a><nav class="breadcrumb"><ul class="is-hidden-mobile"><li><a class="is-disabled">Example: Radon Reconstruction Package</a></li><li class="is-active"><a href>Direct Reconstruction</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Direct Reconstruction</a></li></ul></nav><div class="docs-right"><a class="docs-navbar-link" href="https://github.com/JuliaImageRecon/AbstractImageReconstruction.jl/blob/main/docs/src/literate/example/2_direct.jl#" title="Edit source on GitHub"><span class="docs-icon fa-solid"></span></a><a class="docs-settings-button docs-navbar-link fa-solid fa-gear" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-article-toggle-button fa-solid fa-chevron-up" id="documenter-article-toggle-button" href="javascript:;" title="Collapse all docstrings"></a></div></header><article class="content" id="documenter-page"><h1 id="Direct-Reconstruction"><a class="docs-heading-anchor" href="#Direct-Reconstruction">Direct Reconstruction</a><a id="Direct-Reconstruction-1"></a><a class="docs-heading-anchor-permalink" href="#Direct-Reconstruction" title="Permalink"></a></h1><p>To implement our direct reconstruction algorithms we need to define a few more methods and types. We will start by defining the parameters for the backprojection and for the filtered backprojection. Afterwards we can implement the algorithm itself.</p><h2 id="Parameters-and-Processing"><a class="docs-heading-anchor" href="#Parameters-and-Processing">Parameters and Processing</a><a id="Parameters-and-Processing-1"></a><a class="docs-heading-anchor-permalink" href="#Parameters-and-Processing" title="Permalink"></a></h2><p>For convenience we first introduce a new abstract type for the direct reconstruction paramters:</p><pre><code class="language-julia hljs">abstract type AbstractDirectRadonReconstructionParameters &lt;: AbstractRadonReconstructionParameters end</code></pre><p>The backprojection parameters are simple and only contain the number of angles:</p><pre><code class="language-julia hljs">Base.@kwdef struct RadonBackprojectionParameters &lt;: AbstractDirectRadonReconstructionParameters
  angles::Vector{Float64}
end</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">Main.RadonBackprojectionParameters</code></pre><p>The filtered backprojection parameters are more complex and contain the number of angles and optionally the filter which should be used:</p><pre><code class="language-julia hljs">Base.@kwdef struct RadonFilteredBackprojectionParameters &lt;: AbstractDirectRadonReconstructionParameters
  angles::Vector{Float64}
  filter::Union{Nothing, Vector{Float64}} = nothing
end</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">Main.RadonFilteredBackprojectionParameters</code></pre><p>Since we have defined no default values for the angles, they are required to be set by the user. A more advanced implementation would also allow for the geometry to be set.</p><p>Next we will implement the process steps for both of our backprojection variants. Since RadonKA.jl expects 2D or 3D arrays we have to transform our time series accordingly.</p><pre><code class="language-julia hljs">function AbstractImageReconstruction.process(algoT::Type{&lt;:AbstractDirectRadonAlgorithm}, params::AbstractDirectRadonReconstructionParameters, data::AbstractArray{T, 4}) where {T}
  result = []
  for i = 1:size(data, 4)
    push!(result, process(algoT, params, view(data, :, :, :, i)))
  end
  return cat(result..., dims = 4)
end
AbstractImageReconstruction.process(::Type{&lt;:AbstractDirectRadonAlgorithm}, params::RadonBackprojectionParameters, data::AbstractArray{T, 3}) where {T} = RadonKA.backproject(data, params.angles)
AbstractImageReconstruction.process(::Type{&lt;:AbstractDirectRadonAlgorithm}, params::RadonFilteredBackprojectionParameters, data::AbstractArray{T, 3}) where {T} = RadonKA.backproject_filtered(data, params.angles; filter = params.filter)</code></pre><h2 id="Algorithm"><a class="docs-heading-anchor" href="#Algorithm">Algorithm</a><a id="Algorithm-1"></a><a class="docs-heading-anchor-permalink" href="#Algorithm" title="Permalink"></a></h2><p>The direct reconstruction algorithm has essentially no state to store between reconstructions and thus only needs its parameters as fields. We want our algorithm to accept any combination of our preprocessing and direct reconstruction parameters. This we encode in a new type:</p><pre><code class="language-julia hljs">Base.@kwdef struct DirectRadonParameters{P &lt;: AbstractRadonPreprocessingParameters, R &lt;: AbstractDirectRadonReconstructionParameters} &lt;: AbstractRadonParameters
  pre::P
  reco::R
end</code></pre><p>And the according processing step:</p><pre><code class="language-julia hljs">function AbstractImageReconstruction.process(algoT::Type{&lt;:AbstractDirectRadonAlgorithm}, params::DirectRadonParameters{P, R}, data::AbstractArray{T, 4}) where {T, P&lt;:AbstractRadonPreprocessingParameters, R&lt;:AbstractDirectRadonReconstructionParameters}
  data = process(algoT, params.pre, data)
  return process(algoT, params.reco, data)
end</code></pre><p>Now we can define the algorithm type itself. Algorithms are usually constructed with one argument passing in the user parameters:</p><pre><code class="language-julia hljs">mutable struct DirectRadonAlgorithm{D &lt;: DirectRadonParameters} &lt;: AbstractDirectRadonAlgorithm
  parameter::D
  output::Channel{Any}
  DirectRadonAlgorithm(parameter::D) where D = new{D}(parameter, Channel{Any}(Inf))
end</code></pre><p>And they implement a method to retrieve the used parameters:</p><pre><code class="language-julia hljs">AbstractImageReconstruction.parameter(algo::DirectRadonAlgorithm) = algo.parameter</code></pre><p>Algorithms are assumed to be stateful. To ensure thread safety, we need to implement the <code>lock</code> and <code>unlock</code> functions. We will use the <code>output</code> channel as a lock:</p><pre><code class="language-julia hljs">Base.lock(algo::DirectRadonAlgorithm) = lock(algo.output)
Base.unlock(algo::DirectRadonAlgorithm) = unlock(algo.output)</code></pre><p>And implement the <code>put!</code> and <code>take!</code> functions, mimicking the behavior of a FIFO channel for reconstructions:</p><pre><code class="language-julia hljs">Base.take!(algo::DirectRadonAlgorithm) = Base.take!(algo.output)
function Base.put!(algo::DirectRadonAlgorithm, data::AbstractArray{T, 4}) where {T}
  lock(algo) do
    put!(algo.output, process(algo, algo.parameter, data))
  end
end</code></pre><p>The way the behaviour is implemented here, the algorithm does not buffer any inputs and instead blocks until the currenct reconstruction is done. Outputs are stored until they are retrieved.</p><p>With <code>wait</code> and <code>isready</code> we can check if the algorithm is currently processing data or if it is ready to accept new inputs:</p><pre><code class="language-julia hljs">Base.wait(algo::DirectRadonAlgorithm) = wait(algo.output)
Base.isready(algo::DirectRadonAlgorithm) = isready(algo.output)</code></pre><hr/><p><em>This page was generated using <a href="https://github.com/fredrikekre/Literate.jl">Literate.jl</a>.</em></p></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../1_interface/">« Interface</a><a class="docs-footer-nextpage" href="../3_direct_result/">Direct Reconstruction Result »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="auto">Automatic (OS)</option><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option><option value="catppuccin-latte">catppuccin-latte</option><option value="catppuccin-frappe">catppuccin-frappe</option><option value="catppuccin-macchiato">catppuccin-macchiato</option><option value="catppuccin-mocha">catppuccin-mocha</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 1.11.4 on <span class="colophon-date" title="Tuesday 27 May 2025 11:59">Tuesday 27 May 2025</span>. Using Julia version 1.11.5.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
